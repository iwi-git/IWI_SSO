<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iwi.sso.auth.Auth">

	<select id="selectUser" parameterType="IMap" resultType="IMap">
		SELECT
			USER_SEQ,
			EMAIL
		FROM
			TB_USER
		<where>
			<if test='email != null and email != ""'>
			AND UPPER(EMAIL) = UPPER(#{email})
			</if>
		</where>
	</select>

	<select id="selectUserRefreshToken" parameterType="IMap" resultType="String">
		SELECT
			REF_TOKEN
		FROM
			TB_USER
		WHERE
			UPPER(EMAIL) = UPPER(#{email})
	</select>

	<select id="selectEmailByToken" parameterType="IMap" resultType="String">
		SELECT
			EMAIL
		FROM
			TB_USER
		WHERE
			REF_TOKEN = #{refToken}
	</select>
	
	<select id="selectUserSiteKey" parameterType="IMap" resultType="String">
		SELECT
			B.UNIQUE_KEY
		FROM
			TB_USER A
		LEFT OUTER JOIN TB_USER_SITE_KEY B ON
			A.USER_SEQ = B.USER_SEQ
		WHERE
			UPPER(A.EMAIL) = UPPER(#{email})
			AND UPPER(B.SITE) = UPPER(#{site})
	</select>
	
	<update id="updateUserRefreshToken" parameterType="IMap">
		UPDATE
			TB_USER
		SET
			REF_TOKEN = #{refToken}
		WHERE
			UPPER(EMAIL) = UPPER(#{email})
	</update>

</mapper>